<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{company.name}} | Make.com Sales Opportunity</title>
    <meta name="description" content="{{company.description}}">
    <meta name="view-transition" content="same-origin">
    <meta name="color-scheme" content="light dark">
    <link rel="icon" href="data:image/svg+xml,&lt;svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'&gt;&lt;text y='0.9em' font-size='90'&gt;üöÄ&lt;/text&gt;&lt;/svg&gt;">
    
    <style>
        /* CSS Layers for Perfect Cascade Control */
        @layer reset, design-tokens, components, layouts, utilities, overrides;
        
        @layer reset {
            *, *::before, *::after {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            
            html {
                scroll-behavior: smooth;
                scroll-padding-top: 100px;
                font-synthesis: none;
                text-rendering: optimizeLegibility;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
            
            body {
                margin: 0;
                overflow-x: hidden;
                font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                font-feature-settings: 'liga' 1, 'kern' 1;
                line-height: 1.6;
            }
        }
        
        @layer design-tokens {
            :root {
                /* Color System with Modern CSS Color Functions */
                --primary-hsl: 253 91% 68%;
                --primary: oklch(0.7 0.15 280);
                --primary-variant: color-mix(in oklch, var(--primary), white 20%);
                --on-primary: oklch(1 0 0);
                
                --secondary-hsl: 142 71% 45%;
                --secondary: oklch(0.65 0.15 150);
                --on-secondary: oklch(1 0 0);
                
                --surface: oklch(0.98 0.005 280);
                --surface-variant: oklch(0.95 0.01 280);
                --surface-container: oklch(0.92 0.015 280);
                --on-surface: oklch(0.2 0.02 280);
                --on-surface-variant: oklch(0.45 0.03 280);
                
                --outline: oklch(0.7 0.04 280);
                --outline-variant: oklch(0.85 0.02 280);
                
                --warning: oklch(0.7 0.12 80);
                --error: oklch(0.65 0.15 20);
                --success: oklch(0.65 0.15 150);
                
                /* Dark Mode Colors */
                --dark-surface: oklch(0.12 0.02 280);
                --dark-surface-variant: oklch(0.18 0.03 280);
                --dark-on-surface: oklch(0.9 0.01 280);
                
                /* Spacing System */
                --space-xs: 0.25rem;
                --space-sm: 0.5rem;
                --space-md: 1rem;
                --space-lg: 1.5rem;
                --space-xl: 2rem;
                --space-2xl: 3rem;
                --space-3xl: 4rem;
                
                /* Typography Scale */
                --text-xs: clamp(0.75rem, 0.7rem + 0.2vw, 0.8rem);
                --text-sm: clamp(0.875rem, 0.8rem + 0.3vw, 0.95rem);
                --text-md: clamp(1rem, 0.95rem + 0.25vw, 1.1rem);
                --text-lg: clamp(1.125rem, 1rem + 0.5vw, 1.25rem);
                --text-xl: clamp(1.25rem, 1.1rem + 0.7vw, 1.5rem);
                --text-2xl: clamp(1.5rem, 1.3rem + 1vw, 2rem);
                --text-3xl: clamp(1.875rem, 1.5rem + 1.5vw, 2.5rem);
                --text-4xl: clamp(2.25rem, 1.8rem + 2vw, 3.5rem);
                
                /* Radius System */
                --radius-sm: 0.375rem;
                --radius-md: 0.5rem;
                --radius-lg: 0.75rem;
                --radius-xl: 1rem;
                --radius-2xl: 1.5rem;
                
                /* Shadows with Light/Dark Variants */
                --shadow-sm: 0 1px 2px 0 color-mix(in srgb, var(--on-surface) 5%, transparent);
                --shadow-md: 0 4px 6px -1px color-mix(in srgb, var(--on-surface) 7%, transparent);
                --shadow-lg: 0 10px 15px -3px color-mix(in srgb, var(--on-surface) 10%, transparent);
                --shadow-xl: 0 20px 25px -5px color-mix(in srgb, var(--on-surface) 15%, transparent);
                
                /* Animations */
                --ease-in-out-quart: cubic-bezier(0.77, 0, 0.175, 1);
                --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
                --ease-spring: cubic-bezier(0.68, -0.55, 0.265, 1.55);
                
                /* Grid */
                --grid-max-width: 80rem;
                --grid-gutter: var(--space-md);
            }
            
            @media (prefers-color-scheme: dark) {
                :root {
                    --surface: var(--dark-surface);
                    --surface-variant: var(--dark-surface-variant);
                    --on-surface: var(--dark-on-surface);
                    --surface-container: oklch(0.15 0.025 280);
                    --outline: oklch(0.4 0.04 280);
                    --outline-variant: oklch(0.25 0.03 280);
                }
            }
        }
        
        @layer components {
            /* Modern Button Component */
            .btn {
                --_btn-bg: var(--primary);
                --_btn-color: var(--on-primary);
                --_btn-hover-bg: color-mix(in oklch, var(--primary), white 15%);
                
                display: inline-flex;
                align-items: center;
                gap: var(--space-sm);
                padding: var(--space-sm) var(--space-lg);
                border: none;
                border-radius: var(--radius-md);
                background: var(--_btn-bg);
                color: var(--_btn-color);
                font-size: var(--text-sm);
                font-weight: 600;
                text-decoration: none;
                cursor: pointer;
                transition: all 300ms var(--ease-out-expo);
                transform-origin: center;
                user-select: none;
                
                &:hover {
                    background: var(--_btn-hover-bg);
                    transform: translateY(-2px) scale(1.02);
                    box-shadow: var(--shadow-lg);
                }
                
                &:active {
                    transform: translateY(0) scale(0.98);
                    transition-duration: 100ms;
                }
                
                &.secondary {
                    --_btn-bg: var(--surface-variant);
                    --_btn-color: var(--on-surface);
                    --_btn-hover-bg: var(--surface-container);
                }
            }
            
            /* Status Badges with Modern Design */
            .status-badge {
                --_badge-bg: var(--warning);
                
                display: inline-flex;
                align-items: center;
                gap: var(--space-xs);
                padding: var(--space-xs) var(--space-sm);
                border-radius: var(--radius-2xl);
                background: var(--_badge-bg);
                color: var(--on-primary);
                font-size: var(--text-xs);
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                
                &[data-status="completed"] { --_badge-bg: var(--success); }
                &[data-status="demo"] { --_badge-bg: var(--primary); }
                &[data-status="stalled"] { --_badge-bg: var(--warning); }
                &[data-status="won"] { --_badge-bg: var(--success); }
                &[data-status="lost"] { --_badge-bg: var(--error); }
            }
            
            /* Health Indicator */
            .health-dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: currentColor;
                
                &[data-health="green"] { color: var(--success); }
                &[data-health="yellow"] { color: var(--warning); }
                &[data-health="red"] { color: var(--error); }
            }
            
            /* Modern Card Component */
            .card {
                background: var(--surface-variant);
                border: 1px solid var(--outline-variant);
                border-radius: var(--radius-lg);
                padding: var(--space-lg);
                transition: all 300ms var(--ease-out-expo);
                
                &:hover {
                    transform: translateY(-4px);
                    box-shadow: var(--shadow-xl);
                    border-color: color-mix(in oklch, var(--primary), transparent 70%);
                }
            }
            
            /* Progressive Disclosure - Calm Technology */
            .collapsible {
                border: 1px solid var(--outline-variant);
                border-radius: var(--radius-lg);
                margin-bottom: var(--space-lg);
                overflow: hidden;
                transition: all 200ms var(--ease-out-expo);
                background: var(--surface);
                
                &:hover {
                    box-shadow: var(--shadow-sm);
                    border-color: color-mix(in oklch, var(--primary), transparent 80%);
                }
            }
            
            .collapsible-header {
                background: var(--surface-variant);
                padding: var(--space-md) var(--space-lg);
                cursor: pointer;
                display: flex;
                justify-content: space-between;
                align-items: center;
                user-select: none;
                transition: background 150ms ease;
                border-bottom: 1px solid transparent;
                
                &:hover {
                    background: var(--surface-container);
                }
            }
            
            .collapsible-title {
                font-size: var(--text-md);
                font-weight: 600;
                color: var(--on-surface);
                display: flex;
                align-items: center;
                gap: var(--space-sm);
            }
            
            .collapsible-preview {
                font-size: var(--text-xs);
                color: var(--on-surface-variant);
                font-weight: 400;
                margin-left: var(--space-md);
                opacity: 0.8;
            }
            
            .collapsible.expanded .collapsible-preview {
                display: none;
            }
            
            .collapsible-icon {
                width: 20px;
                height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: var(--text-sm);
                color: var(--on-surface-variant);
                transition: transform 200ms var(--ease-out-expo);
                background: var(--surface);
                border-radius: var(--radius-sm);
                border: 1px solid var(--outline-variant);
            }
            
            .collapsible.expanded .collapsible-icon {
                transform: rotate(180deg);
                background: var(--primary);
                color: var(--on-primary);
                border-color: var(--primary);
            }
            
            .collapsible-content {
                max-height: 0;
                overflow: hidden;
                transition: max-height 300ms var(--ease-out-expo);
            }
            
            .collapsible.expanded .collapsible-content {
                max-height: 150vh;
            }
            
            .collapsible-body {
                padding: var(--space-lg);
                background: var(--surface);
                border-top: 1px solid var(--outline-variant);
            }
            
            /* Essential Information Always Visible */
            .always-visible {
                border: none;
                background: transparent;
                margin-bottom: var(--space-md);
            }
            
            .always-visible .collapsible-content {
                max-height: none;
                overflow: visible;
            }
            
            .always-visible .collapsible-header {
                background: transparent;
                padding: var(--space-sm) 0;
                cursor: default;
                border-bottom: 2px solid var(--primary);
            }
            
            .always-visible .collapsible-icon {
                display: none;
            }
        }
        
        @layer layouts {
            body {
                background: var(--surface);
                color: var(--on-surface);
                font-size: var(--text-md);
            }
            
            /* Container with CSS Grid */
            .container {
                max-width: var(--grid-max-width);
                margin: 0 auto;
                padding: 0 var(--grid-gutter);
                
                @container (max-width: 768px) {
                    padding: 0 var(--space-md);
                }
            }
            
            /* Modern Navigation */
            .nav {
                position: sticky;
                top: 0;
                z-index: 1000;
                backdrop-filter: blur(20px) saturate(180%);
                background: color-mix(in srgb, var(--surface) 80%, transparent);
                border-bottom: 1px solid var(--outline-variant);
                padding: var(--space-md) 0;
            }
            
            .nav-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .nav-brand {
                font-size: var(--text-lg);
                font-weight: 800;
                color: var(--primary);
                text-decoration: none;
            }
            
            .nav-links {
                display: flex;
                gap: var(--space-lg);
                list-style: none;
                
                @container (max-width: 768px) {
                    display: none;
                }
            }
            
            .nav-link {
                color: var(--on-surface-variant);
                text-decoration: none;
                font-weight: 600;
                position: relative;
                transition: color 200ms ease;
                
                &:hover, &.active {
                    color: var(--primary);
                }
                
                &.active::after {
                    content: '';
                    position: absolute;
                    bottom: -24px;
                    left: 0;
                    right: 0;
                    height: 2px;
                    background: var(--primary);
                    border-radius: 1px;
                }
            }
            
            /* Hero Section - Effortless Information Hierarchy */
            .hero {
                padding: var(--space-2xl) 0;
                background: linear-gradient(135deg, 
                    var(--surface-variant) 0%, 
                    color-mix(in oklch, var(--primary), transparent 95%) 100%);
                border-bottom: 1px solid var(--outline-variant);
            }
            
            .hero-content {
                display: grid;
                grid-template-columns: 1fr auto;
                gap: var(--space-xl);
                align-items: center;
                text-align: left;
            }
            
            .company-name {
                font-size: var(--text-3xl);
                font-weight: 800;
                color: var(--on-surface);
                margin-bottom: var(--space-xs);
                letter-spacing: -0.01em;
            }
            
            .company-meta {
                font-size: var(--text-md);
                color: var(--on-surface-variant);
                margin-bottom: var(--space-sm);
                font-weight: 500;
            }
            
            .company-description {
                font-size: var(--text-sm);
                color: var(--on-surface-variant);
                line-height: 1.5;
                max-width: 50ch;
            }
            
            /* Critical Status at a Glance */
            .hero-status {
                display: flex;
                flex-direction: column;
                gap: var(--space-sm);
                align-items: flex-end;
                text-align: right;
            }
            
            .critical-status {
                display: flex;
                align-items: center;
                gap: var(--space-sm);
                padding: var(--space-sm) var(--space-md);
                background: var(--surface);
                border: 1px solid var(--outline-variant);
                border-radius: var(--radius-lg);
                font-weight: 600;
                box-shadow: var(--shadow-sm);
            }
            
            .next-action-summary {
                font-size: var(--text-xs);
                color: var(--on-surface-variant);
                font-weight: 500;
                max-width: 25ch;
            }
            
            @container (max-width: 768px) {
                .hero-content {
                    grid-template-columns: 1fr;
                    text-align: center;
                }
                
                .hero-status {
                    align-items: center;
                    text-align: center;
                }
            }
            
            /* Status Dashboard with CSS Grid */
            .status-dashboard {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: var(--space-lg);
                margin: var(--space-3xl) 0;
            }
            
            .status-card {
                background: var(--surface-variant);
                border: 1px solid var(--outline-variant);
                border-radius: var(--radius-lg);
                padding: var(--space-lg);
                position: relative;
                overflow: hidden;
                transition: all 300ms var(--ease-out-expo);
                
                &::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    height: 3px;
                    background: linear-gradient(90deg, var(--primary), var(--secondary));
                }
                
                &:hover {
                    transform: translateY(-4px);
                    box-shadow: var(--shadow-xl);
                }
            }
            
            .status-label {
                font-size: var(--text-xs);
                font-weight: 700;
                color: var(--on-surface-variant);
                text-transform: uppercase;
                letter-spacing: 0.1em;
                margin-bottom: var(--space-sm);
            }
            
            .status-value {
                font-size: var(--text-xl);
                font-weight: 800;
                color: var(--on-surface);
                margin-bottom: var(--space-xs);
            }
            
            .status-meta {
                font-size: var(--text-sm);
                color: var(--on-surface-variant);
            }
            
            /* Section Layouts */
            .section {
                margin: var(--space-3xl) 0;
            }
            
            .section-header {
                text-align: center;
                margin-bottom: var(--space-2xl);
            }
            
            .section-title {
                font-size: var(--text-3xl);
                font-weight: 800;
                color: var(--on-surface);
                margin-bottom: var(--space-sm);
                letter-spacing: -0.01em;
            }
            
            .section-subtitle {
                font-size: var(--text-md);
                color: var(--on-surface-variant);
            }
            
            /* Grid Layouts */
            .card-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: var(--space-lg);
            }
            
            .contact-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: var(--space-lg);
            }
            
            .systems-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: var(--space-md);
            }
        }
        
        @layer utilities {
            .text-center { text-align: center; }
            .font-bold { font-weight: 700; }
            .hidden { display: none !important; }
            
            /* View Transition Names */
            .company-name { view-transition-name: company-name; }
            .status-dashboard { view-transition-name: status-dashboard; }
            .nav { view-transition-name: navigation; }
        }
        
        /* CSS Container Queries */
        @container (max-width: 768px) {
            .status-dashboard,
            .card-grid,
            .contact-grid,
            .systems-grid {
                grid-template-columns: 1fr;
            }
            
            .collapsible-header {
                padding: var(--space-md);
            }
            
            .collapsible-body {
                padding: var(--space-md);
            }
        }
        
        /* Advanced Animations - Performance Optimized */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }
        
        .animate-in {
            animation: slideInUp 400ms var(--ease-out-expo) both;
        }
        
        .fade-in {
            animation: fadeIn 300ms ease both;
        }
        
        /* Purposeful loading states */
        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        /* Immediate feedback animations */
        @keyframes success-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .success-feedback {
            animation: success-pulse 200ms ease-out;
        }
        
        /* Intersection Observer Animations */
        .intersection-animate {
            opacity: 0;
            transform: translateY(20px);
            transition: all 600ms var(--ease-out-expo);
        }
        
        .intersection-animate.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Print Styles */
        @media print {
            .nav, .collapsible-icon { display: none; }
            .collapsible-content { max-height: none !important; }
            .section { break-inside: avoid; }
            * { color-adjust: exact; }
        }
        
        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation with Backdrop Filter -->
    <nav class="nav">
        <div class="container">
            <div class="nav-content">
                <a href="#" class="nav-brand">{{company.name}} Opportunity</a>
                <ul class="nav-links">
                    <li><a href="#overview" class="nav-link">Overview</a></li>
                    <li><a href="#contacts" class="nav-link">Contacts</a></li>
                    <li><a href="#technical" class="nav-link">Technical</a></li>
                    <li><a href="#timeline" class="nav-link">Timeline</a></li>
                    <li><a href="#risks" class="nav-link">Risks</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section - Effortless Information Access -->
    <header class="hero">
        <div class="container">
            <div class="hero-content animate-in">
                <div class="hero-main">
                    <h1 class="company-name">{{company.name}}</h1>
                    <div class="company-meta">{{company.location}} ‚Ä¢ {{company.industry}}</div>
                    {{#company.description}}
                    <p class="company-description">{{company.description}}</p>
                    {{/company.description}}
                </div>
                
                <!-- Critical Status at a Glance -->
                <div class="hero-status">
                    <div class="critical-status">
                        <span class="health-dot" data-health="{{status.health}}"></span>
                        <span class="status-badge" data-status="{{status.stage}}">{{status.stage}}</span>
                    </div>
                    {{#status.nextAction}}
                    <div class="next-action-summary">Next: {{status.nextAction}}</div>
                    {{/status.nextAction}}
                    {{#overview.value}}
                    <div class="next-action-summary" style="color: var(--success); font-weight: 600;">{{overview.value}}</div>
                    {{/overview.value}}
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Status Dashboard -->
        <section class="status-dashboard intersection-animate">
            <div class="status-card">
                <div class="status-label">Current Stage</div>
                <div class="status-value">
                    <span class="status-badge" data-status="{{status.stage}}">
                        <span class="health-dot" data-health="{{status.health}}"></span>
                        {{status.stage}}
                    </span>
                </div>
                <div class="status-meta">{{status.currentPhase}}</div>
            </div>
            
            <div class="status-card">
                <div class="status-label">Last Activity</div>
                <div class="status-value">{{status.lastActivity}}</div>
                <div class="status-meta">{{status.salesCycle}}</div>
            </div>
            
            <div class="status-card">
                <div class="status-label">Next Action</div>
                <div class="status-value">{{status.nextAction}}</div>
                <div class="status-meta">Critical for momentum</div>
            </div>

            {{#overview.value}}
            <div class="status-card">
                <div class="status-label">Opportunity Value</div>
                <div class="status-value">{{overview.value}}</div>
                <div class="status-meta">Multi-year potential</div>
            </div>
            {{/overview.value}}
        </section>

        <!-- Essential Overview - Always Visible -->
        <section id="overview" class="section intersection-animate">
            <div class="always-visible">
                <div class="collapsible-header">
                    <h2 class="collapsible-title">üíº Business Overview</h2>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-body">
                        <div style="background: linear-gradient(135deg, var(--primary), color-mix(in oklch, var(--primary), var(--secondary) 30%)); color: var(--on-primary); padding: var(--space-lg); border-radius: var(--radius-lg); margin-bottom: var(--space-lg);">
                            <h4 style="font-size: var(--text-lg); font-weight: 700; margin-bottom: var(--space-sm);">{{overview.useCase}}</h4>
                            <p style="opacity: 0.9;">{{overview.solution}}</p>
                        </div>
                        
                        {{#overview.businessDrivers}}
                        <h4 style="margin-bottom: var(--space-md); color: var(--on-surface); font-weight: 700;">Business Drivers</h4>
                        <div style="display: grid; gap: var(--space-sm);">
                            {{#overview.businessDrivers}}
                            <div style="display: flex; align-items: center; gap: var(--space-sm); padding: var(--space-sm); background: var(--surface-variant); border-radius: var(--radius-md);">
                                <span style="color: var(--success); font-size: var(--text-lg);">‚úì</span>
                                <span>{{.}}</span>
                            </div>
                            {{/overview.businessDrivers}}
                        </div>
                        {{/overview.businessDrivers}}

                        <div style="margin-top: var(--space-lg); padding: var(--space-lg); background: var(--surface-variant); border-radius: var(--radius-md);">
                            <h4 style="margin-bottom: var(--space-sm); color: var(--on-surface); font-weight: 700;">Current Pain Points</h4>
                            <p style="color: var(--on-surface-variant);">{{overview.pain}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contacts Section -->
        <section id="contacts" class="section intersection-animate">
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h3 class="collapsible-title">
                        üë• Key Stakeholders
                        <span class="collapsible-preview">{{contacts.primary.name}} + {{#contacts.technical}}{{#unless @first}}, {{/unless}}{{name}}{{/contacts.technical}}</span>
                    </h3>
                    <span class="collapsible-icon">‚ñ∂</span>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-body">
                        <div class="contact-grid">
                            <!-- Primary Contact -->
                            <div class="card" style="border-left: 4px solid var(--primary);">
                                <div style="font-size: var(--text-lg); font-weight: 700; color: var(--on-surface); margin-bottom: var(--space-xs);">
                                    {{contacts.primary.name}} ‚≠ê
                                </div>
                                <div style="font-size: var(--text-sm); color: var(--on-surface-variant); margin-bottom: var(--space-sm);">
                                    {{contacts.primary.role}}
                                </div>
                                <div style="font-size: var(--text-sm);">
                                    <a href="mailto:{{contacts.primary.email}}" style="color: var(--primary); text-decoration: none; font-weight: 600;">{{contacts.primary.email}}</a>
                                    {{#contacts.primary.phone}}
                                    <br><span style="color: var(--on-surface-variant);">{{contacts.primary.phone}}</span>
                                    {{/contacts.primary.phone}}
                                </div>
                                {{#contacts.primary.notes}}
                                <div style="font-size: var(--text-xs); color: var(--on-surface-variant); margin-top: var(--space-sm); padding-top: var(--space-sm); border-top: 1px solid var(--outline-variant); font-style: italic;">
                                    {{contacts.primary.notes}}
                                </div>
                                {{/contacts.primary.notes}}
                            </div>

                            <!-- Technical Contacts -->
                            {{#contacts.technical}}
                            <div class="card">
                                <div style="font-size: var(--text-lg); font-weight: 700; color: var(--on-surface); margin-bottom: var(--space-xs);">{{name}}</div>
                                <div style="font-size: var(--text-sm); color: var(--on-surface-variant); margin-bottom: var(--space-sm);">{{role}}</div>
                                <div style="font-size: var(--text-sm);">
                                    {{#email}}
                                    <a href="mailto:{{email}}" style="color: var(--primary); text-decoration: none; font-weight: 600;">{{email}}</a>
                                    {{/email}}
                                    {{#phone}}
                                    <br><span style="color: var(--on-surface-variant);">{{phone}}</span>
                                    {{/phone}}
                                </div>
                                {{#notes}}
                                <div style="font-size: var(--text-xs); color: var(--on-surface-variant); margin-top: var(--space-sm); padding-top: var(--space-sm); border-top: 1px solid var(--outline-variant); font-style: italic;">
                                    {{notes}}
                                </div>
                                {{/notes}}
                            </div>
                            {{/contacts.technical}}
                        </div>
                    </div>
                </div>
            </div>

            {{#contacts.makeTeam}}
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h3 class="collapsible-title">
                        üöÄ Make.com Team
                        <span class="collapsible-preview">{{#contacts.makeTeam}}{{name}}{{#unless @last}}, {{/unless}}{{/contacts.makeTeam}}</span>
                    </h3>
                    <span class="collapsible-icon">‚ñ∂</span>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-body">
                        <div class="contact-grid">
                            {{#contacts.makeTeam}}
                            <div class="card">
                                <div style="font-size: var(--text-lg); font-weight: 700; color: var(--on-surface); margin-bottom: var(--space-xs);">{{name}}</div>
                                <div style="font-size: var(--text-sm); color: var(--on-surface-variant); margin-bottom: var(--space-sm);">{{role}}</div>
                                <div style="font-size: var(--text-sm);">
                                    <a href="mailto:{{email}}" style="color: var(--primary); text-decoration: none; font-weight: 600;">{{email}}</a>
                                </div>
                                {{#notes}}
                                <div style="font-size: var(--text-xs); color: var(--on-surface-variant); margin-top: var(--space-sm); padding-top: var(--space-sm); border-top: 1px solid var(--outline-variant); font-style: italic;">
                                    {{notes}}
                                </div>
                                {{/notes}}
                            </div>
                            {{/contacts.makeTeam}}
                        </div>
                    </div>
                </div>
            </div>
            {{/contacts.makeTeam}}
        </section>

        <!-- Technical Section -->
        <section id="technical" class="section intersection-animate">
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h3 class="collapsible-title">
                        ‚öôÔ∏è Technical Architecture
                        <span class="collapsible-preview">{{technical.complexity}} complexity ‚Ä¢ {{#technical.systems}}{{name}}{{#unless @last}}, {{/unless}}{{/technical.systems}}</span>
                    </h3>
                    <span class="collapsible-icon">‚ñ∂</span>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-body">
                        <div style="display: flex; align-items: center; gap: var(--space-md); margin-bottom: var(--space-lg);">
                            <span style="font-weight: 700;">Complexity:</span>
                            <span class="status-badge" data-status="{{technical.complexity}}" style="text-transform: uppercase;">{{technical.complexity}}</span>
                        </div>

                        {{#technical.architecture}}
                        <div style="background: var(--surface-variant); border: 1px solid var(--outline-variant); border-radius: var(--radius-lg); padding: var(--space-lg); margin: var(--space-lg) 0; font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace; font-size: var(--text-sm); overflow-x: auto;">
                            <h4 style="margin-bottom: var(--space-sm); color: var(--on-surface); font-family: inherit;">Data Flow</h4>
                            <div style="white-space: pre-wrap;">{{technical.architecture.dataFlow}}</div>
                        </div>

                        <h4 style="margin: var(--space-lg) 0 var(--space-md) 0; color: var(--on-surface); font-weight: 700;">Integration Components</h4>
                        <div style="display: grid; gap: var(--space-sm);">
                            {{#technical.architecture.components}}
                            <div style="display: flex; align-items: center; gap: var(--space-sm); padding: var(--space-sm); background: var(--surface-variant); border-radius: var(--radius-md);">
                                <span style="font-size: var(--text-lg);">üîß</span>
                                <span>{{.}}</span>
                            </div>
                            {{/technical.architecture.components}}
                        </div>
                        {{/technical.architecture}}
                    </div>
                </div>
            </div>

            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h3 class="collapsible-title">Systems Integration</h3>
                    <span class="collapsible-icon">‚ñº</span>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-body">
                        <div class="systems-grid">
                            {{#technical.systems}}
                            <div class="card">
                                <div style="font-size: var(--text-md); font-weight: 700; color: var(--on-surface); margin-bottom: var(--space-xs);">{{name}}</div>
                                <div style="font-size: var(--text-xs); color: var(--on-surface-variant); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-sm);">{{type}} ‚Ä¢ {{deployment}}</div>
                                <div style="font-size: var(--text-sm); color: var(--on-surface-variant);">{{details}}</div>
                            </div>
                            {{/technical.systems}}
                        </div>
                    </div>
                </div>
            </div>

            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h3 class="collapsible-title">Technical Challenges</h3>
                    <span class="collapsible-icon">‚ñº</span>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-body">
                        <div style="display: grid; gap: var(--space-sm);">
                            {{#technical.challenges}}
                            <div style="background: color-mix(in oklch, var(--error), transparent 95%); border-left: 3px solid var(--error); padding: var(--space-md); border-radius: 0 var(--radius-md) var(--radius-md) 0; font-size: var(--text-sm); line-height: 1.5;">
                                {{.}}
                            </div>
                            {{/technical.challenges}}
                        </div>
                    </div>
                </div>
            </div>

            {{#technical.developmentApproach}}
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h3 class="collapsible-title">Development Approach</h3>
                    <span class="collapsible-icon">‚ñº</span>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-body">
                        <div class="card-grid">
                            <div class="card">
                                <div style="margin-bottom: var(--space-md);">
                                    <div style="font-size: var(--text-lg); font-weight: 700; color: var(--on-surface); margin-bottom: var(--space-xs);">Technology Stack</div>
                                </div>
                                <div style="font-size: var(--text-sm); line-height: 1.6;">
                                    <p><strong>Platform:</strong> {{technical.developmentApproach.preferredTechnology}}</p>
                                    <p><strong>SDK License:</strong> {{technical.developmentApproach.sdkLicense}}</p>
                                    <p><strong>Programming Model:</strong> {{technical.developmentApproach.programmingModel}}</p>
                                </div>
                            </div>

                            <div class="card">
                                <div style="margin-bottom: var(--space-md);">
                                    <div style="font-size: var(--text-lg); font-weight: 700; color: var(--on-surface); margin-bottom: var(--space-xs);">Integration Pattern</div>
                                </div>
                                <div style="font-size: var(--text-sm); line-height: 1.6;">
                                    <p><strong>API Pattern:</strong> {{technical.developmentApproach.apiPattern}}</p>
                                    <p><strong>Data Format:</strong> {{technical.developmentApproach.dataFormat}}</p>
                                    <p><strong>Security:</strong> {{technical.developmentApproach.securityModel}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {{/technical.developmentApproach}}
        </section>

        <!-- Timeline Section -->
        <section id="timeline" class="section intersection-animate">
            <div class="section-header">
                <h2 class="section-title">Project Timeline</h2>
                <p class="section-subtitle">Milestones and implementation schedule</p>
            </div>

            <div class="collapsible expanded">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h3 class="collapsible-title">Sales Milestones</h3>
                    <span class="collapsible-icon">‚ñº</span>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-body">
                        <div style="position: relative; margin: var(--space-lg) 0;">
                            <div style="position: absolute; left: 20px; top: 0; bottom: 0; width: 2px; background: var(--outline);"></div>
                            {{#timeline.milestones}}
                            <div style="position: relative; padding: var(--space-md) 0 var(--space-md) 60px; margin-bottom: var(--space-md);">
                                <div style="position: absolute; left: 14px; top: 20px; width: 12px; height: 12px; border-radius: 50%; background: var(--primary); border: 2px solid var(--surface);"></div>
                                <div style="font-size: var(--text-xs); font-weight: 700; color: var(--on-surface-variant); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-xs);">{{date}}</div>
                                <div style="font-size: var(--text-md); font-weight: 700; color: var(--on-surface); margin-bottom: var(--space-xs);">{{event}}</div>
                                {{#details}}
                                <div style="font-size: var(--text-sm); color: var(--on-surface-variant); margin-bottom: var(--space-sm);">{{details}}</div>
                                {{/details}}
                                <span class="status-badge" data-status="{{status}}">{{status}}</span>
                            </div>
                            {{/timeline.milestones}}
                        </div>

                        {{#timeline.expectedClose}}
                        <div style="margin-top: var(--space-lg); padding: var(--space-md); background: var(--surface-variant); border-radius: var(--radius-md);">
                            <strong>Expected Close:</strong> {{timeline.expectedClose}}
                        </div>
                        {{/timeline.expectedClose}}
                    </div>
                </div>
            </div>

            {{#timeline.implementationTimeline}}
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h3 class="collapsible-title">Implementation Timeline</h3>
                    <span class="collapsible-icon">‚ñº</span>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-body">
                        <div class="card-grid">
                            <div class="card">
                                <div style="margin-bottom: var(--space-md);">
                                    <div style="font-size: var(--text-lg); font-weight: 700; color: var(--on-surface); margin-bottom: var(--space-xs);">Custom SDK Development</div>
                                    <div style="font-size: var(--text-sm); color: var(--on-surface-variant);">Full integration approach</div>
                                </div>
                                <div style="font-size: var(--text-sm); line-height: 1.6;">
                                    <p><strong>Timeline:</strong> {{timeline.implementationTimeline.customSDK}}</p>
                                    <p>Includes planning, development, and testing phases</p>
                                </div>
                            </div>

                            {{#timeline.implementationTimeline.cloudMigration}}
                            <div class="card">
                                <div style="margin-bottom: var(--space-md);">
                                    <div style="font-size: var(--text-lg); font-weight: 700; color: var(--on-surface); margin-bottom: var(--space-xs);">Cloud Migration Alternative</div>
                                    <div style="font-size: var(--text-sm); color: var(--on-surface-variant);">Faster time-to-value</div>
                                </div>
                                <div style="font-size: var(--text-sm); line-height: 1.6;">
                                    <p><strong>Timeline:</strong> {{timeline.implementationTimeline.cloudMigration}}</p>
                                    <p>Migration plus standard API integration</p>
                                </div>
                            </div>
                            {{/timeline.implementationTimeline.cloudMigration}}
                        </div>
                    </div>
                </div>
            </div>
            {{/timeline.implementationTimeline}}
        </section>

        <!-- Risks Section -->
        <section id="risks" class="section intersection-animate">
            <div class="section-header">
                <h2 class="section-title">Risk Assessment</h2>
                <p class="section-subtitle">Potential blockers and mitigation strategies</p>
            </div>

            <div class="collapsible expanded">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h3 class="collapsible-title">Risk Analysis</h3>
                    <span class="collapsible-icon">‚ñº</span>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-body">
                        <div style="display: grid; gap: var(--space-md);">
                            {{#risks}}
                            <div class="card">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-sm);">
                                    <div style="font-size: var(--text-md); font-weight: 600; color: var(--on-surface); flex: 1; margin-right: var(--space-md);">{{description}}</div>
                                    <span class="status-badge" data-status="{{impact}}" style="text-transform: uppercase;">{{impact}} impact</span>
                                </div>
                                <div style="font-size: var(--text-sm); color: var(--on-surface-variant); line-height: 1.5;">
                                    <strong>Mitigation:</strong> {{mitigation}}
                                </div>
                            </div>
                            {{/risks}}
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pricing Section -->
        {{#pricing}}
        <section class="section intersection-animate">
            <div class="section-header">
                <h2 class="section-title">Investment & ROI</h2>
                <p class="section-subtitle">Pricing structure and expansion opportunities</p>
            </div>

            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h3 class="collapsible-title">Current Proposal</h3>
                    <span class="collapsible-icon">‚ñº</span>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-body">
                        <div style="background: linear-gradient(135deg, var(--primary), color-mix(in oklch, var(--primary), var(--secondary) 30%)); color: var(--on-primary); border-radius: var(--radius-lg); padding: var(--space-2xl); text-align: center; margin: var(--space-lg) 0;">
                            <div style="font-size: var(--text-2xl); font-weight: 800; margin-bottom: var(--space-sm);">{{pricing.currentProposal.totalYear1}}</div>
                            <div style="opacity: 0.9; margin-bottom: var(--space-lg);">Year 1 Investment</div>
                            <div style="text-align: left;">
                                <p>Platform Fee: {{pricing.currentProposal.platformFee}}</p>
                                <p>Operations: {{pricing.currentProposal.operationsCost}}</p>
                                <p>Implementation: {{pricing.currentProposal.implementation}}</p>
                                <p style="margin-top: var(--space-sm); font-size: var(--text-sm); opacity: 0.9;">
                                    Recurring: {{pricing.currentProposal.annualRecurring}} annually
                                </p>
                            </div>
                        </div>

                        <div style="margin-top: var(--space-md); padding: var(--space-md); background: var(--surface-variant); border-radius: var(--radius-md); font-size: var(--text-sm);">
                            <strong>Operations Example:</strong> {{pricing.currentProposal.operationsExample}}
                        </div>
                    </div>
                </div>
            </div>

            {{#pricing.expansionOpportunity}}
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h3 class="collapsible-title">Expansion Opportunity</h3>
                    <span class="collapsible-icon">‚ñº</span>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-body">
                        <div class="card">
                            <div style="margin-bottom: var(--space-md);">
                                <div style="font-size: var(--text-lg); font-weight: 700; color: var(--on-surface); margin-bottom: var(--space-xs);">Mexico Phase 2</div>
                                <div style="font-size: var(--text-sm); color: var(--on-surface-variant);">Additional revenue potential</div>
                            </div>
                            <div style="font-size: var(--text-sm); line-height: 1.6;">
                                <p><strong>Additional Value:</strong> {{pricing.expansionOpportunity.mexicoPhase2}}</p>
                                <p><strong>Total Engagement:</strong> {{pricing.expansionOpportunity.totalMultiYear}}</p>
                                <p style="margin-top: var(--space-sm); color: var(--on-surface-variant);">
                                    {{pricing.expansionOpportunity.note}}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {{/pricing.expansionOpportunity}}
        </section>
        {{/pricing}}

        <!-- Call Notes Section -->
        {{#notes}}
        <section class="section intersection-animate">
            <div class="section-header">
                <h2 class="section-title">Call Intelligence</h2>
                <p class="section-subtitle">Meeting notes and key insights</p>
            </div>

            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h3 class="collapsible-title">Call History</h3>
                    <span class="collapsible-icon">‚ñº</span>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-body">
                        {{#notes}}
                        <div class="card" style="margin-bottom: var(--space-md);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-sm);">
                                <div style="font-size: var(--text-sm); color: var(--on-surface-variant);">{{date}} ‚Ä¢ {{author}}</div>
                                <span style="padding: var(--space-xs) var(--space-sm); border-radius: var(--radius-2xl); font-size: var(--text-xs); font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; background: var(--surface-container); color: var(--on-surface-variant);">{{type}}</span>
                            </div>
                            <div style="font-size: var(--text-sm); line-height: 1.6; color: var(--on-surface);">{{content}}</div>
                            {{#recording}}
                            <div style="margin-top: var(--space-sm);">
                                <a href="#" style="color: var(--primary); text-decoration: none; font-weight: 600; font-size: var(--text-xs);">üé• {{recording}}</a>
                            </div>
                            {{/recording}}
                        </div>
                        {{/notes}}
                    </div>
                </div>
            </div>
        </section>
        {{/notes}}

        <!-- Action Items -->
        {{#callToAction}}
        <section class="section intersection-animate">
            <div class="section-header">
                <h2 class="section-title">Next Steps</h2>
                <p class="section-subtitle">Critical actions and success metrics</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-lg); margin: var(--space-2xl) 0;">
                <div style="background: linear-gradient(135deg, var(--surface-variant), var(--surface-container)); border: 1px solid var(--outline-variant); border-radius: var(--radius-lg); padding: var(--space-lg);">
                    <div style="font-size: var(--text-lg); font-weight: 700; color: var(--on-surface); margin-bottom: var(--space-md);">Immediate Actions</div>
                    <div style="margin-bottom: var(--space-md); padding: var(--space-sm); background: var(--primary); color: var(--on-primary); border-radius: var(--radius-md); font-weight: 600;">
                        {{callToAction.immediateNext}}
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, var(--surface-variant), var(--surface-container)); border: 1px solid var(--outline-variant); border-radius: var(--radius-lg); padding: var(--space-lg);">
                    <div style="font-size: var(--text-lg); font-weight: 700; color: var(--on-surface); margin-bottom: var(--space-md);">Critical Questions</div>
                    <div style="display: grid; gap: var(--space-sm);">
                        {{#callToAction.criticalQuestions}}
                        <div style="padding: var(--space-sm) 0; font-size: var(--text-sm); color: var(--on-surface-variant); border-bottom: 1px solid var(--outline-variant); line-height: 1.5;">{{.}}</div>
                        {{/callToAction.criticalQuestions}}
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, var(--surface-variant), var(--surface-container)); border: 1px solid var(--outline-variant); border-radius: var(--radius-lg); padding: var(--space-lg);">
                    <div style="font-size: var(--text-lg); font-weight: 700; color: var(--on-surface); margin-bottom: var(--space-md);">Success Metrics</div>
                    <div style="display: grid; gap: var(--space-sm);">
                        {{#callToAction.successMetrics}}
                        <div style="padding: var(--space-sm) 0; font-size: var(--text-sm); color: var(--on-surface-variant); border-bottom: 1px solid var(--outline-variant); line-height: 1.5;">{{.}}</div>
                        {{/callToAction.successMetrics}}
                    </div>
                </div>
            </div>
        </section>
        {{/callToAction}}
    </main>

    <footer style="margin-top: var(--space-3xl); padding: var(--space-2xl) 0; border-top: 1px solid var(--outline-variant); text-align: center; color: var(--on-surface-variant); font-size: var(--text-sm);">
        <div class="container">
            <p>Generated with <span style="color: var(--primary); font-weight: 700;">Make.com Sales Portal</span> ‚Ä¢ Last updated: {{lastUpdated}}</p>
            <p style="margin-top: var(--space-sm); font-size: var(--text-xs);">Opportunity ID: {{opportunityId}}</p>
        </div>
    </footer>

    <script>
        // Web Components for Modern Architecture
        class OpportunityPortal extends HTMLElement {
            constructor() {
                super();
                this.initializeObservers();
                this.bindEvents();
            }

            connectedCallback() {
                this.initializeAnimations();
                this.setupViewTransitions();
            }

            initializeObservers() {
                // Intersection Observer for Scroll Animations
                this.intersectionObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                        }
                    });
                }, {
                    threshold: 0.1,
                    rootMargin: '0px 0px -50px 0px'
                });

                // Observe all animatable elements
                document.querySelectorAll('.intersection-animate').forEach(el => {
                    this.intersectionObserver.observe(el);
                });
            }

            setupViewTransitions() {
                // Modern View Transitions API
                if ('startViewTransition' in document) {
                    document.addEventListener('click', (e) => {
                        if (e.target.matches('.nav-link')) {
                            e.preventDefault();
                            const targetId = e.target.getAttribute('href');
                            const target = document.querySelector(targetId);
                            
                            if (target) {
                                document.startViewTransition(() => {
                                    target.scrollIntoView({ behavior: 'smooth' });
                                });
                            }
                        }
                    });
                }
            }

            initializeAnimations() {
                // Web Animations API for Complex Animations
                this.setupParallaxEffects();
                this.animateCounters();
            }

            setupParallaxEffects() {
                const hero = document.querySelector('.hero');
                if (hero) {
                    window.addEventListener('scroll', () => {
                        const scrolled = window.pageYOffset;
                        const parallax = scrolled * 0.5;
                        hero.style.transform = `translateY(${parallax}px)`;
                    });
                }
            }

            animateCounters() {
                const counters = document.querySelectorAll('[data-counter]');
                counters.forEach(counter => {
                    const target = parseInt(counter.dataset.counter);
                    const animation = counter.animate([
                        { '--counter': 0 },
                        { '--counter': target }
                    ], {
                        duration: 2000,
                        easing: 'ease-out'
                    });
                });
            }

            bindEvents() {
                // Remove existing listeners first to avoid duplicates
                this.unbindEvents();
                
                // Enhanced Event Delegation
                this.clickHandler = this.handleClick.bind(this);
                this.scrollHandler = this.handleScroll.bind(this);
                this.pointerHandler = this.handlePointerDown.bind(this);
                
                document.addEventListener('click', this.clickHandler);
                document.addEventListener('scroll', this.scrollHandler);
                document.addEventListener('pointerdown', this.pointerHandler);
            }
            
            unbindEvents() {
                if (this.clickHandler) {
                    document.removeEventListener('click', this.clickHandler);
                }
                if (this.scrollHandler) {
                    document.removeEventListener('scroll', this.scrollHandler);
                }
                if (this.pointerHandler) {
                    document.removeEventListener('pointerdown', this.pointerHandler);
                }
            }

            handleClick(e) {
                // Purposeful micro-interactions aligned with design philosophy
                if (e.target.closest('.collapsible-header')) {
                    const header = e.target.closest('.collapsible-header');
                    const collapsible = header.parentElement;
                    const content = collapsible.querySelector('.collapsible-content');
                    const icon = header.querySelector('.collapsible-icon');
                    
                    // Skip interaction for always-visible sections
                    if (collapsible.classList.contains('always-visible')) return;
                    
                    // Immediate feedback - button state change
                    header.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        header.style.transform = '';
                    }, 100);
                    
                    if (collapsible.classList.contains('expanded')) {
                        // Collapse with gentle animation - calm technology
                        const animation = content.animate([
                            { 
                                maxHeight: content.scrollHeight + 'px', 
                                opacity: 1,
                                transform: 'translateY(0)'
                            },
                            { 
                                maxHeight: '0px', 
                                opacity: 0,
                                transform: 'translateY(-10px)'
                            }
                        ], {
                            duration: 250,
                            easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
                        });
                        
                        animation.onfinish = () => {
                            collapsible.classList.remove('expanded');
                        };
                    } else {
                        // Expand with purposeful animation
                        collapsible.classList.add('expanded');
                        
                        // Subtle visual feedback for successful action
                        const ripple = document.createElement('div');
                        ripple.style.cssText = `
                            position: absolute;
                            border-radius: 50%;
                            background: color-mix(in oklch, var(--primary), transparent 80%);
                            transform: scale(0);
                            animation: ripple 300ms ease-out;
                            pointer-events: none;
                            left: ${e.clientX - header.getBoundingClientRect().left - 10}px;
                            top: ${e.clientY - header.getBoundingClientRect().top - 10}px;
                            width: 20px;
                            height: 20px;
                        `;
                        
                        header.style.position = 'relative';
                        header.appendChild(ripple);
                        setTimeout(() => ripple.remove(), 300);
                        
                        content.animate([
                            { 
                                maxHeight: '0px', 
                                opacity: 0,
                                transform: 'translateY(-10px)'
                            },
                            { 
                                maxHeight: content.scrollHeight + 'px', 
                                opacity: 1,
                                transform: 'translateY(0)'
                            }
                        ], {
                            duration: 300,
                            easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
                        });
                    }
                }
                
                // Email link interactions - helpful feedback
                if (e.target.matches('a[href^="mailto:"]')) {
                    // Subtle confirmation that email action is happening
                    const link = e.target;
                    const originalText = link.textContent;
                    link.style.transform = 'scale(0.95)';
                    link.textContent = 'üìß Opening...';
                    
                    setTimeout(() => {
                        link.style.transform = '';
                        link.textContent = originalText;
                    }, 500);
                }
            }

            handleScroll() {
                // Navigation scroll spy with modern features
                this.updateActiveNavigation();
                this.updateScrollProgress();
            }

            handlePointerDown(e) {
                // Modern pointer interaction feedback
                if (e.target.matches('.btn') || e.target.matches('.card')) {
                    e.target.style.setProperty('--pointer-x', e.clientX + 'px');
                    e.target.style.setProperty('--pointer-y', e.clientY + 'px');
                }
            }

            updateActiveNavigation() {
                const sections = document.querySelectorAll('section[id]');
                const navLinks = document.querySelectorAll('.nav-link');
                
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop - 100;
                    if (window.scrollY >= sectionTop) {
                        current = section.getAttribute('id');
                    }
                });
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === '#' + current) {
                        link.classList.add('active');
                    }
                });
            }

            updateScrollProgress() {
                const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrolled = (winScroll / height) * 100;
                
                document.documentElement.style.setProperty('--scroll-progress', scrolled + '%');
            }
        }

        // Service Worker removed due to data URL restrictions
        // Modern browsers don't allow service workers with data URLs for security

        // Global Functions for Template Compatibility
        function toggleCollapsible(header) {
            // Avoid infinite recursion by directly calling the portal's handleClick
            const portal = document.querySelector('opportunity-portal') || new OpportunityPortal();
            const fakeEvent = { target: header, clientX: 0, clientY: 0 };
            portal.handleClick(fakeEvent);
        }

        // URL Data Processing and Template Population
        async function loadOpportunityData() {
            try {
                // Check for compressed data in URL hash
                const hash = window.location.hash;
                if (hash.startsWith('#/gz/')) {
                    const compressedData = hash.substring(5); // Remove '#/gz/'
                    
                    // Decode base64 and decompress
                    const binaryData = Uint8Array.from(atob(compressedData), c => c.charCodeAt(0));
                    const decompressed = new DecompressionStream('gzip');
                    const writer = decompressed.writable.getWriter();
                    const reader = decompressed.readable.getReader();
                    
                    writer.write(binaryData);
                    writer.close();
                    
                    const chunks = [];
                    let done = false;
                    while (!done) {
                        const { value, done: readerDone } = await reader.read();
                        done = readerDone;
                        if (value) chunks.push(value);
                    }
                    
                    const jsonString = new TextDecoder().decode(new Uint8Array(chunks.reduce((acc, chunk) => [...acc, ...chunk], [])));
                    const opportunityData = JSON.parse(jsonString);
                    
                    // Populate template with data
                    populateTemplate(opportunityData);
                    return;
                }
                
                // Fallback: show template placeholders
                console.log('No opportunity data found in URL');
                
            } catch (error) {
                console.error('Error loading opportunity data:', error);
                // Show error message or fallback
            }
        }

        function populateTemplate(data) {
            // Safe template renderer that updates only content, not scripts
            
            function renderTemplate(template, context) {
                // Handle array iterations {{#array}}...{{/array}}
                template = template.replace(/{{#(\w+(?:\.\w+)*)}}([\s\S]*?){{\/\1}}/g, (match, path, content) => {
                    const value = getNestedValue(context, path);
                    
                    if (Array.isArray(value)) {
                        return value.map(item => {
                            let itemContent = content;
                            // Handle {{.}} for primitive array values
                            itemContent = itemContent.replace(/{{\.}}/g, item);
                            // Handle object properties
                            if (typeof item === 'object' && item !== null) {
                                itemContent = renderTemplate(itemContent, item);
                            }
                            return itemContent;
                        }).join('');
                    } else if (value && typeof value === 'object') {
                        // Object exists, render content with object context
                        return renderTemplate(content, value);
                    } else if (value) {
                        // Truthy value, show content
                        return renderTemplate(content, context);
                    } else {
                        // Falsy value, hide content
                        return '';
                    }
                });
                
                // Handle simple variable substitutions {{variable}}
                template = template.replace(/{{(\w+(?:\.\w+)*)}}/g, (match, path) => {
                    const value = getNestedValue(context, path);
                    return value !== undefined && value !== null ? String(value) : '';
                });
                
                return template;
            }
            
            function getNestedValue(obj, path) {
                return path.split('.').reduce((current, prop) => {
                    return current && current[prop] !== undefined ? current[prop] : undefined;
                }, obj);
            }
            
            // Update only the body content to avoid script issues
            const bodyContent = document.body.innerHTML;
            let processedContent = bodyContent;
            let previousContent = '';
            let iterations = 0;
            
            // Keep processing until no more changes or max iterations
            while (processedContent !== previousContent && iterations < 10) {
                previousContent = processedContent;
                processedContent = renderTemplate(processedContent, data);
                iterations++;
            }
            
            // Also update title and meta description
            if (data.company && data.company.name) {
                document.title = `${data.company.name} | Make.com Sales Opportunity`;
            }
            
            const metaDesc = document.querySelector('meta[name="description"]');
            if (metaDesc && data.company && data.company.description) {
                metaDesc.content = data.company.description;
            }
            
            // Clean up any remaining unprocessed placeholders
            processedContent = processedContent.replace(/{{[^}]*}}/g, '');
            
            // Update the body content safely
            document.body.innerHTML = processedContent;
            
            // Re-initialize event listeners after content update
            setTimeout(() => {
                if (window.portal) {
                    window.portal.bindEvents();
                }
            }, 100);
        }

        // Performance-First Initialization
        document.addEventListener('DOMContentLoaded', async () => {
            // Performance monitoring
            const startTime = performance.now();
            
            // Critical path: Load opportunity data first
            await loadOpportunityData();
            
            // Initialize components with progressive enhancement
            if ('customElements' in window) {
                customElements.define('opportunity-portal', OpportunityPortal);
                window.portal = new OpportunityPortal();
                if (!document.body.querySelector('opportunity-portal')) {
                    document.body.appendChild(window.portal);
                }
            } else {
                // Fallback for older browsers
                window.portal = new OpportunityPortal();
            }
            
            // Performance feedback - align with "Performance as Experience"
            const loadTime = performance.now() - startTime;
            if (loadTime > 1000) {
                console.warn(`Portal load time: ${loadTime.toFixed(2)}ms - Consider optimization`);
            }
            
            // Prefetch critical fonts for immediate next interactions
            if ('fonts' in document) {
                document.fonts.ready.then(() => {
                    document.body.classList.add('fonts-loaded');
                });
            }
            
            // Progressive enhancement: Advanced features
            requestIdleCallback(() => {
                // Non-critical enhancements when browser is idle
                if ('IntersectionObserver' in window) {
                    // Advanced scroll animations
                }
                if ('PerformanceObserver' in window) {
                    // Performance monitoring
                }
            });
        });

        // Modern CSS Custom Properties Animation
        document.documentElement.style.setProperty('--load-time', Date.now());

        // Performance Observer for Core Web Vitals
        if ('PerformanceObserver' in window) {
            new PerformanceObserver((list) => {
                for (const entry of list.getEntries()) {
                    if (entry.entryType === 'largest-contentful-paint') {
                        console.log('LCP:', entry.startTime);
                    }
                }
            }).observe({ entryTypes: ['largest-contentful-paint'] });
        }

        // CSS Paint Worklet Registration (if supported)
        if ('CSS' in window && 'paintWorklet' in CSS) {
            CSS.paintWorklet.addModule('data:text/javascript;base64,' + btoa(`
                class GradientPainter {
                    paint(ctx, size, props) {
                        const gradient = ctx.createLinearGradient(0, 0, size.width, size.height);
                        gradient.addColorStop(0, 'oklch(0.7 0.15 280)');
                        gradient.addColorStop(1, 'oklch(0.65 0.15 150)');
                        ctx.fillStyle = gradient;
                        ctx.fillRect(0, 0, size.width, size.height);
                    }
                }
                registerPaint('custom-gradient', GradientPainter);
            `));
        }
    </script>
</body>
</html>